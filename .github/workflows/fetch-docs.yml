name: ðŸ”„ Fetch and Cache F1 Docs

on:
  schedule:
    - cron: "0 */1 * * *" # every hour
  workflow_dispatch:
    inputs:
      date:
        description: "Date to run the workflow"
        required: true
        type: string
        default: "in 1 hour"
concurrency:
  group: schedule${{ github.event.inputs.date }}
  cancel-in-progress: true

jobs:
  update-cache:
    runs-on: ubuntu-latest
    env:
      CACHE_TOKEN: ${{ secrets.CACHE_TOKEN }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          persist-credentials: true

      - name: Install Bun
        uses: oven-sh/setup-bun@v2

      - name: Install dependencies
        run: bun install

      - name: Run cache regeneration
        run: bun scripts/fetch-all.ts

      - name: Commit changes
        uses: EndBug/add-and-commit@v9
        with:
          author_name: Jonathan Canevese
          author_email: work@jcanevese.it
          message: "Aggiornata cache F1"
          add: "*.json"
        env:
          GITHUB_TOKEN: ${{ secrets.TOKEN_GITHUB }}
